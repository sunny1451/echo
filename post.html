<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post - Echo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #f0f2f5, #e6f0fa);
    }
    .nav-button {
      transition: all 0.3s ease;
    }
    .nav-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .post-section {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen font-sans text-gray-800">
  <nav class="bg-gray-900 text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold tracking-wide">Echo</a>
      <div class="flex space-x-4">
        <button onclick="window.location.href='posthistory.html'" class="nav-button bg-transparent border-2 border-white text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-white hover:text-gray-900">Post History</button>
        <button onclick="window.location.href='comments.html'" class="nav-button bg-transparent border-2 border-white text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-white hover:text-gray-900">Comments</button>
        <button onclick="window.location.href='likes.html'" class="nav-button bg-transparent border-2 border-white text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-white hover:text-gray-900">Likes</button>
      </div>
    </div>
  </nav>

  <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <section class="post-section bg-white rounded-2xl shadow-xl p-8">
      <h2 class="text-2xl font-semibold text-gray-900 mb-6 border-b-2 border-gray-200 pb-2">Project Details</h2>
      <div class="space-y-6">
        <div>
          <label for="ideaTitle" class="block text-sm font-medium text-gray-700">Idea Title</label>
          <input type="text" id="ideaTitle" placeholder="nothing" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200">
        </div>
        <div>
          <label for="problemSolving" class="block text-sm font-medium text-gray-700">Problem it's solving</label>
          <input type="text" id="problemSolving" placeholder="nothing" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200">
        </div>
        <div>
          <label for="targetUsers" class="block text-sm font-medium text-gray-700">Target Users</label>
          <input type="text" id="targetUsers" placeholder="everyone" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200">
        </div>
        <div>
          <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
          <textarea id="description" placeholder="Add project details" rows="5" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200 resize-vertical"></textarea>
        </div>
        <button id="postButton" class="bg-blue-600 text-white px-6 py-2 rounded-full font-medium hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">Post</button>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js";

    console.log("Script loaded");

    const firebaseConfig = {
      apiKey: "AIzaSyBFoIoUsTJ_4NzkV-sdNffAOjbHRxSRIp8",
      authDomain: "echo-625fa.firebaseapp.com",
      projectId: "echo-625fa",
      storageBucket: "echo-625fa.appspot.com",
      messagingSenderId: "890702112097",
      appId: "1:890702112097:web:e81927ba359a8c426c1120",
      measurementId: "G-DMBW4N7J2T"
    };

    try {
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      console.log("Firebase initialized");

      const postButton = document.getElementById('postButton');
      let currentUser = null;

      if (!postButton) {
        console.error("Post button not found");
      } else {
        console.log("Post button found");
        postButton.addEventListener('click', async () => {
          console.log("Post button clicked");
          await postIdea();
        });
      }

      async function postIdea() {
        console.log("postIdea called");
        if (!currentUser) {
          console.log("No user logged in");
          alert("Please log in to post an idea.");
          window.location.href = "login.html";
          return;
        }

        const ideaTitle = document.getElementById('ideaTitle').value.trim();
        const problemSolving = document.getElementById('problemSolving').value.trim();
        const targetUsers = document.getElementById('targetUsers').value.trim();
        const description = document.getElementById('description').value.trim();

        console.log("Form data:", { ideaTitle, problemSolving, targetUsers, description });

        if (!ideaTitle && !problemSolving && !targetUsers && !description) {
          console.log("No data provided");
          alert("Please provide at least one detail.");
          return;
        }

        try {
          const postData = {
            userId: currentUser.uid,
            ideaTitle,
            problemSolving,
            targetUsers,
            description,
            timestamp: new Date().toISOString(),
          };

          console.log("Saving post:", postData);
          const postsRef = collection(db, "posts");
          const docRef = await addDoc(postsRef, postData);
          console.log("Post saved, ID:", docRef.id);

          const userRef = doc(db, "users", currentUser.uid);
          await updateDoc(userRef, {
            posts: arrayUnion(docRef.id)
          });
          console.log("User posts updated");

          alert("Post submitted successfully!");
          console.log("Redirecting to scrollit.html");
          window.location.href = 'scrollit.html';
        } catch (error) {
          console.error("Error posting idea:", error);
          alert(`Failed to post: ${error.message}`);
        }
      }

      onAuthStateChanged(auth, (user) => {
        console.log("Auth state:", user ? "Logged in" : "No user");
        if (!user) {
          window.location.href = "login.html";
          return;
        }
        currentUser = user;
        console.log("User set:", currentUser.uid);
      });
    } catch (error) {
      console.error("Initialization error:", error);
      alert("Failed to initialize app.");
    }
  </script>
</body>
</html>
