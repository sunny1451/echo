<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile - Echo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #f6f8fa);
      color: #24292f;
      line-height: 1.6;
      min-height: 100vh;
    }

/* Navigation Bar Styles */
.navbar {
  background: linear-gradient(90deg, #2da44e 0%, #218739 100%);
  padding: 15px 20px;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
  border-bottom: 2px solid #ffffff33;
}

.nav-container {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nav-logo {
  color: white;
  font-size: 32px; /* Slightly increased font size for stronger presence */
  font-weight: 700;
  text-decoration: none;
  letter-spacing: 2.5px; /* Increased letter spacing for more distinct look */
  text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5); /* Enhanced text shadow for a prominent, "super writing" effect */
  font-family: "Pacifico", cursive; /* Ensures the unique font is applied */
  transition: all 0.3s ease; /* Smooth transition for hover effects */
}

/* Optional: Subtle hover effect for the logo if desired */
.nav-logo:hover {
  transform: scale(1.03); /* Slightly enlarge on hover */
  text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.6); /* Further enhance shadow on hover */
}


.nav-links {
  display: flex;
  gap: 20px;
  align-items: center;
}

.nav-links a {
  color: white;
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 15px;
  border-radius: 25px;
  transition: all 0.3s ease;
}

.nav-links a:hover {
  background-color: rgba(255, 255, 255, 0.25);
  transform: translateY(-3px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
}

.nav-links a.active {
  background-color: white;
  color: #2da44e;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

.nav-links img {
  width: 20px;
  height: 20px;
  filter: brightness(0) invert(1);
}

.nav-links a.active img {
  filter: brightness(0) invert(0);
}

/* Increased top padding for the main content container to ensure it clears the sticky navbar */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 100px 20px 40px 20px; /* Increased top padding from 90px to 100px */
}

    .initial-profile {
      background: linear-gradient(135deg, #2da44e 0%, #218739 100%);
      border-radius: 12px;
      padding: 30px;
      color: white;
      margin-bottom: 30px;
      position: relative;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
      border: 1px solid #ffffff33;
    }

    .initial-profile h2 {
      font-size: 26px;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .basic-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }

    .basic-info p {
      font-size: 16px;
      opacity: 0.9;
    }

    .basic-info strong {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 17px;
    }

    .edit-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: #fff;
      color: #2da44e;
      border: 2px solid #fff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .edit-btn:hover {
      background-color: #2da44e;
      color: #fff;
      border-color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background: linear-gradient(to bottom, #ffffff, #f9f9f9);
      padding: 35px;
      border-radius: 12px;
      width: 100%;
      max-width: 650px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.25);
      border: 1px solid #e0e0e0;
    }

    .modal-content h3 {
      font-size: 24px;
      margin-bottom: 25px;
      color: #2da44e;
      font-weight: 600;
      border-bottom: 2px solid #2da44e;
      padding-bottom: 5px;
    }

    .modal-content .form-group {
      margin-bottom: 25px;
    }

    .modal-content label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 15px;
      color: #24292f;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 12px;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }

    .modal-content input:focus,
    .modal-content select:focus {
      border-color: #2da44e;
      outline: none;
      box-shadow: 0 0 5px rgba(45, 164, 78, 0.3);
    }

    .modal-content input:invalid:not(:placeholder-shown) {
      border-color: #dc3545;
    }

    .location-group {
      display: flex;
      gap: 15px;
    }

    .location-group input {
      flex: 1;
    }

    .skills-container {
      position: relative;
      width: 100%;
    }

    .skills-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      font-size: 14px;
    }

    .skills-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: #fff;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 100;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
      display: none;
    }

    .skills-suggestions div {
      padding: 10px 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .skills-suggestions div:hover {
      background-color: #f0f2f5;
    }

    .skills-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .skill-tag {
      background-color: #e1e4e8;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background-color 0.3s ease;
    }

    .skill-tag:hover {
      background-color: #d0d7de;
    }

    .skill-tag .remove-skill {
      cursor: pointer;
      color: #dc3545;
      font-weight: bold;
    }

    .project-box {
      background-color: #f6f8fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }

    .project-box:hover {
      transform: translateY(-2px);
    }

    .add-project-btn,
    .remove-project-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #2da44e;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .remove-project-btn {
      right: 50px;
      background-color: #dc3545;
    }

    .add-project-btn:hover {
      background-color: #218739;
    }

    .remove-project-btn:hover {
      background-color: #c82333;
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: flex-end;
    }

    .modal-buttons button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .save-btn {
      background-color: #2da44e;
      color: white;
    }

    .save-btn:hover {
      background-color: #218739;
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .cancel-btn {
      background-color: #d0d7de;
      color: #24292f;
    }

    .cancel-btn:hover {
      background-color: #c0c7ce;
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 28px;
      cursor: pointer;
      color: #586069;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: #dc3545;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 30px;
      background: linear-gradient(to right, #ffffff, #f9f9f9);
      border: 1px solid #d8dee4;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      transition: transform 0.3s ease;
      flex-wrap: wrap;
    }

    .profile-header:hover {
      transform: translateY(-5px);
    }

    .profile-picture-container {
      position: relative;
      cursor: pointer;
    }

    .profile-picture {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #d8dee4;
      transition: border-color 0.3s ease;
    }

    .profile-picture:hover {
      border-color: #2da44e;
    }

    .profile-picture-placeholder {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background-color: #e1e4e8;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #d8dee4;
      color: #586069;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.3s ease;
    }

    .profile-picture-placeholder:hover {
      background-color: #d0d7de;
    }

    .profile-action-mark {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: #2da44e;
      color: white;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-action-mark:hover {
      background-color: #218739;
      transform: scale(1.1);
    }

    .social-icons {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-top: 20px;
      width: 100%;
    }

    .social-icon {
      width: 35px;
      height: 35px;
      object-fit: contain;
      transition: transform 0.3s ease;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .social-icon:hover {
      transform: scale(1.2);
    }

    .profile-info {
      flex: 1;
    }

    .profile-info h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 600;
      color: #1a3c34;
    }

    .level, .status {
      font-size: 16px;
      color: #586069;
      margin-bottom: 12px;
      font-style: italic;
    }

    .top-coder-badge {
      display: inline-block;
      background-color: #ffd700;
      color: #24292f;
      font-size: 14px;
      padding: 6px 14px;
      border-radius: 15px;
      margin-left: 10px;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }

    .btn {
      padding: 12px 25px;
      background-color: #2da44e;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background-color: #218739;
      transform: scale(1.05);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    .about {
      background: linear-gradient(to right, #ffffff, #f9f9f9);
      border: 1px solid #d8dee4;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .about:hover {
      transform: translateY(-5px);
    }

    .about h2 {
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: 600;
      color: #1a3c34;
    }

    .about-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }

    .about-item {
      margin-bottom: 15px;
    }

    .about-item strong {
      display: block;
      font-size: 17px;
      margin-bottom: 8px;
      font-weight: 600;
      color: #1a3c34;
    }

    .about-item p {
      font-size: 15px;
      color: #586069;
    }

    .about-item .skills-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .about-item .skill {
      background-color: #e1e4e8;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      transition: background-color 0.3s ease;
    }

    .about-item .skill:hover {
      background-color: #d0d7de;
    }

    .about-item a {
      color: #2da44e;
      text-decoration: none;
      margin-right: 12px;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .about-item a:hover {
      color: #218739;
      text-decoration: underline;
    }

    .projects {
      background: linear-gradient(to right, #ffffff, #f9f9f9);
      border: 1px solid #d8dee4;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .projects:hover {
      transform: translateY(-5px);
    }

    .projects h2 {
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: 600;
      color: #1a3c34;
    }

    .project-card {
      background-color: #fff;
      border: 1px solid #e1e4e8;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    .project-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }

    .project-card h3 {
      font-size: 20px;
      margin-bottom: 12px;
      font-weight: 600;
      color: #1a3c34;
    }

    .project-meta {
      font-size: 14px;
      color: #586069;
      margin-bottom: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .project-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .project-description {
      font-size: 15px;
      margin-bottom: 15px;
      color: #333;
    }

    .project-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .tag {
      background-color: #e1e4e8;
      padding: 5px 12px;
      border-radius: 6px;
      font-size: 13px;
      transition: background-color 0.3s ease;
    }

    .tag:hover {
      background-color: #d0d7de;
    }

    .project-links {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .project-links a {
      color: #2da44e;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .project-links a:hover {
      color: #218739;
      text-decoration: underline;
    }

    .project-links img.star-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .project-links img.star-icon:hover {
      transform: scale(1.2);
    }

    .rating {
      font-size: 14px;
      color: #586069;
    }

    .non-coder-section {
      background: linear-gradient(to right, #ffffff, #f9f9f9);
      border: 1px solid #d8dee4;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .non-coder-section:hover {
      transform: translateY(-5px);
    }

    .non-coder-section h2 {
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: 600;
      color: #1a3c34;
    }

    .non-coder-section p {
      font-size: 15px;
      color: #586069;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
 <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../../index.html" class="nav-logo">Echo</a>
            <div class="nav-links">
                <!-- Converted to relative paths -->
                <a href="../role/profile/search/search.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/3917/3917132.png" alt="Search Icon" />
                    Search
                </a>
                <a href="posts.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/9350/9350064.png" alt="Posts Icon" />
                    Posts
                </a>
                <a href="settings.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/4508/4508440.png" alt="Settings Icon" />
                    Settings
                </a>
                <a href="../role/profile/codersprofile.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" alt="Profile Icon" />
                    Profile
                </a>
                <a href="message.html" class="active">
                    <img src="https://cdn-icons-png.flaticon.com/512/893/893257.png" alt="Chats Icon" />
                    Chats
                </a>
                <a href="reels.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/4379/4379560.png" alt="Reels Icon" />
                    Reels
                </a>
                <a href="portfolio.html">
                    <img src="https://cdn-icons-png.flaticon.com/512/10493/10493865.png" alt="Portfolio Icon" />
                    Portfolio
                </a>
            </div>
        </div>
    </nav>

  <div class="container">
    <div class="initial-profile">
      <h2>Basic Information</h2>
      <div class="basic-info">
        <div>
          <strong>Full Name</strong>
          <p id="basicFullName">Loading...</p>
        </div>
        <div>
          <strong>Email</strong>
          <p id="basicEmail">Loading...</p>
        </div>
        <div>
          <strong>Date of Birth</strong>
          <p id="basicDob">Loading...</p>
        </div>
        <div>
          <strong>Role</strong>
          <p id="basicRole">Loading...</p>
        </div>
      </div>
      <button class="edit-btn" id="editProfileBtn" style="display: none;" onclick="openEditModal()">Edit Profile</button>
    </div>

    <div class="modal" id="editModal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeEditModal()">×</span>
        <h3>Edit Profile</h3>
        <div class="form-group">
          <label for="editFullName">Full Name</label>
          <input type="text" id="editFullName" required />
        </div>
        <div class="form-group">
          <label for="editUsername">Username</label>
          <input type="text" id="editUsername" required />
        </div>
        <div class="form-group">
          <label for="editEmail">Email</label>
          <input type="email" id="editEmail" required />
        </div>
        <div class="form-group">
          <label for="editDob">Date of Birth</label>
          <input type="date" id="editDob" required />
        </div>
        <div class="form-group">
          <label for="editRole">Role</label>
          <select id="editRole" required>
            <option value="coder">Coder</option>
            <option value="non-coder">Non-Coder</option>
          </select>
        </div>
        <div class="form-group coder-only">
          <label for="editLanguages">Languages (comma-separated)</label>
          <input type="text" id="editLanguages" />
        </div>
        <div class="form-group coder-only">
          <label for="editAppTypes">App Types (comma-separated)</label>
          <input type="text" id="editAppTypes" />
        </div>
        <div class="form-group coder-only">
          <label for="editIsTopCoder">Is Top Coder</label>
          <select id="editIsTopCoder">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>
        </div>
        <div class="form-group coder-only">
          <label>Skills</label>
          <div class="skills-container">
            <input type="text" class="skills-input" id="skillsInput" placeholder="Type to add skills..." />
            <div class="skills-suggestions" id="skillsSuggestions"></div>
            <div class="skills-tags" id="skillsTags"></div>
          </div>
        </div>
        <div class="form-group coder-only">
          <label>Projects</label>
          <div id="projectsContainer">
            <!-- Projects will be dynamically added here -->
          </div>
        </div>
        <div class="form-group non-coder-only">
          <label for="editInterests">Interests (comma-separated)</label>
          <input type="text" id="editInterests" />
        </div>
        <div class="form-group">
          <label>Location</label>
          <div class="location-group">
            <input type="text" id="editDistrict" placeholder="District" />
            <input type="text" id="editState" placeholder="State" />
            <input type="text" id="editCountry" placeholder="Country" />
          </div>
        </div>
        <div class="form-group">
          <label for="editJoined">Joined Date</label>
          <input type="date" id="editJoined" />
        </div>
        <div class="form-group">
          <label for="editGithubLink">GitHub Link</label>
          <input type="url" id="editGithubLink" placeholder="https://github.com/username" />
        </div>
        <div class="form-group">
          <label for="editLinkedinLink">LinkedIn Link</label>
          <input type="url" id="editLinkedinLink" placeholder="https://linkedin.com/in/username" />
        </div>
        <div class="form-group">
          <label for="editInstagramLink">Instagram Link</label>
          <input type="url" id="editInstagramLink" placeholder="https://instagram.com/username" />
        </div>
        <div class="form-group">
          <label for="editWebsiteLink">Website Link</label>
          <input type="url" id="editWebsiteLink" placeholder="https://yourwebsite.com" />
        </div>
        <div class="modal-buttons">
          <button class="save-btn" onclick="confirmSave()">Save</button>
          <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
        </div>
      </div>
    </div>

    <div class="profile-header">
      <div class="profile-picture-container" id="profilePictureContainer">
        <img id="profilePicture" src="https://via.placeholder.com/120" alt="Profile Picture" class="profile-picture" style="display: none;" />
        <div id="profilePicturePlaceholder" class="profile-picture-placeholder">Add Photo</div>
        <span id="profileActionMark" class="profile-action-mark" style="display: none;">+</span>
      </div>
      <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" />
      <div class="profile-info">
        <h1 id="fullName">Loading...</h1>
        <div class="level" id="level">Level 0</div>
        <div class="status" id="status">Not specified</div>
        <span id="topCoderBadge" class="top-coder-badge coder-only" style="display: none;">Top Coder</span>
        <div class="action-buttons">
          <button class="btn coder-only" id="portfolioBtn" onclick="scrollToProjects()">View Full Portfolio</button>
          <button class="btn" id="shareProfileBtn">Share Profile</button>
        </div>
      </div>
      <div class="social-icons">
        <a id="githubIconLink" href="#" target="_blank" style="display: none;">
          <img src="https://static-00.iconduck.com/assets.00/github-icon-2048x2048-dpporae2.png" alt="GitHub" class="social-icon" />
        </a>
        <a id="linkedinIconLink" href="#" target="_blank" style="display: none;">
          <img src="https://static.vecteezy.com/system/resources/previews/017/339/624/original/linkedin-icon-free-png.png" alt="LinkedIn" class="social-icon" />
        </a>
        <a id="instagramIconLink" href="#" target="_blank" style="display: none;">
          <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram" class="social-icon" />
        </a>
        <a id="websiteIconLink" href="#" target="_blank" style="display: none;">
          <img src="https://icon-library.com/images/website-link-icon/website-link-icon-3.jpg" alt="Website" class="social-icon" />
        </a>
      </div>
    </div>

    <div class="about">
      <h2>About</h2>
      <div class="about-grid">
        <div class="about-item coder-only">
          <strong>💼 Skills</strong>
          <div id="skillsList" class="skills-list">
            <span class="skill">Loading...</span>
          </div>
        </div>
        <div class="about-item non-coder-only">
          <strong>🎯 Interests</strong>
          <div id="interestsList" class="skills-list">
            <span class="skill">Loading...</span>
          </div>
        </div>
        <div class="about-item">
          <strong>📍 Location</strong>
          <p id="location">Not specified</p>
        </div>
        <div class="about-item">
          <strong>📅 Joined</strong>
          <p id="joined">Not specified</p>
        </div>
        <div class="about-item">
          <strong>🔗 Linked Accounts</strong>
          <p id="linkedAccounts">
            <a href="#" id="githubLink" style="display: none;">GitHub</a>
            <a href="#" id="linkedinLink" style="display: none;">LinkedIn</a>
            <a href="#" id="websiteLink" style="display: none;">Website</a>
            <a href="#" id="instagramLink" style="display: none;">Instagram</a>
          </p>
        </div>
      </div>
    </div>

    <div class="projects coder-only" id="projectsSection">
      <h2>Projects</h2>
      <div id="projectsList">
        <div class="project-card">
          <p>Loading projects...</p>
        </div>
      </div>
    </div>

    <div class="non-coder-section non-coder-only" id="nonCoderInfo">
      <h2>Additional Information</h2>
      <p id="nonCoderDetails">Loading additional information...</p>
    </div>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc, query, collection, where, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBFoIoUsTJ_4NzkV-sdNffAOjbHRxSRIp8",
    authDomain: "echo-625fa.firebaseapp.com",
    projectId: "echo-625fa",
    storageBucket: "echo-625fa.appspot.com",
    messagingSenderId: "890702112097",
    appId: "1:890702112097:web:e81927ba359a8c426c1120",
    measurementId: "G-DMBW4N7J2T"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUserData = null;
  let currentUsername = null;
  let isDataLoaded = false;
  let selectedSkills = [];
  let profileImageUrl = '';
  let isOwner = false;
  let loggedInUserUid = null;
  let userRole = null;
  let projects = [];

  const IMAGEKIT_PRIVATE_KEY = 'private_keidOpgelVBXCjFeq1v6cC3Zh8M=';
  const IMAGEKIT_PUBLIC_KEY = 'public_kVKXQSuwDPXHQEV2SP1zrkVDgAM=';
  const IMAGEKIT_URL_ENDPOINT = 'https://ik.imagekit.io/RentaLRoomS/';

  const predefinedSkills = ["Deep Learning", "Communication", "Java", "Python"];

  const skillsInput = document.getElementById("skillsInput");
  const skillsSuggestions = document.getElementById("skillsSuggestions");
  const skillsTags = document.getElementById("skillsTags");

  function updateSkillsSuggestions(value) {
    skillsSuggestions.innerHTML = "";
    if (!value) {
      skillsSuggestions.style.display = "none";
      return;
    }

    const filteredSkills = predefinedSkills.filter(skill => 
      skill.toLowerCase().includes(value.toLowerCase()) && !selectedSkills.includes(skill)
    );

    filteredSkills.forEach(skill => {
      const div = document.createElement("div");
      div.textContent = skill;
      div.onclick = () => addSkill(skill);
      skillsSuggestions.appendChild(div);
    });

    skillsSuggestions.style.display = filteredSkills.length ? "block" : "none";
  }

  function addSkill(skill) {
    if (!selectedSkills.includes(skill)) {
      selectedSkills.push(skill);
      renderSkillsTags();
    }
    skillsInput.value = "";
    skillsSuggestions.style.display = "none";
  }

  function removeSkill(skill) {
    selectedSkills = selectedSkills.filter(s => s !== skill);
    renderSkillsTags();
  }

  function renderSkillsTags() {
    skillsTags.innerHTML = "";
    selectedSkills.forEach(skill => {
      const tag = document.createElement("div");
      tag.className = "skill-tag";
      tag.innerHTML = `${sanitizeHTML(skill)} <span class="remove-skill" onclick="removeSkill('${sanitizeHTML(skill)}')">×</span>`;
      skillsTags.appendChild(tag);
    });
  }

  function sanitizeHTML(str) {
    const div = document.createElement("div");
    div.textContent = str;
    return div.innerHTML;
  }

  skillsInput.addEventListener("input", (e) => {
    updateSkillsSuggestions(e.target.value);
  });

  skillsInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && skillsInput.value.trim()) {
      const newSkill = skillsInput.value.trim();
      if (!selectedSkills.includes(newSkill)) {
        addSkill(newSkill);
      }
    }
  });

  const profilePictureInput = document.getElementById("profilePictureInput");
  const profilePicture = document.getElementById("profilePicture");
  const profilePicturePlaceholder = document.getElementById("profilePicturePlaceholder");
  const profileActionMark = document.getElementById("profileActionMark");
  const profilePictureContainer = document.getElementById("profilePictureContainer");

  window.triggerProfilePictureUpload = () => {
    if (!isOwner) {
      return;
    }
    if (!currentUsername) {
      alert("Please wait for profile to load or log in again.");
      return;
    }
    if (profileImageUrl) {
      if (confirm("Do you want to remove the current profile picture?")) {
        removeProfilePicture();
      }
    } else {
      profilePictureInput.click();
    }
  };

  async function uploadToImageKit(file, fileName) {
    try {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('fileName', fileName);
      formData.append('publicKey', IMAGEKIT_PUBLIC_KEY);
      formData.append('folder', `/profiles/${currentUsername}`);
      formData.append('tags', `profile,${currentUsername}`);

      const response = await fetch('https://upload.imagekit.io/api/v1/files/upload', {
        method: 'POST',
        headers: { Authorization: `Basic ${btoa(IMAGEKIT_PRIVATE_KEY + ':')}` },
        body: formData
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`ImageKit upload failed: ${errorText}`);
      }

      const data = await response.json();
      if (!data.url) {
        throw new Error("No image URL returned from ImageKit.");
      }
      return data.url;
    } catch (error) {
      console.error('ImageKit upload error:', error);
      throw error;
    }
  }

  async function updateProfileImage(event) {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    const file = event.target.files[0];
    if (!file) return;
    const name = currentUserData?.fullName?.trim() || currentUsername || "anonymous";

    try {
      if (!file.type.startsWith("image/")) {
        throw new Error("Please select an image file (PNG/JPG).");
      }
      if (file.size > 5 * 1024 * 1024) {
        throw new Error("Image size must be less than 5MB.");
      }
      if (!currentUsername) {
        throw new Error("User not logged in. Please refresh and try again.");
      }

      const fileName = `profile_${name}_${Date.now()}_${file.name}`;
      profileImageUrl = await uploadToImageKit(file, fileName);

      await updateDoc(doc(db, "users", currentUsername), {
        "profile.profilePicture": profileImageUrl
      });

      profilePicture.src = profileImageUrl;
      profilePicture.alt = "Profile Picture";
      profilePicture.style.display = "block";
      profilePicture.onerror = () => {
        console.error("Failed to load profile image");
        profilePicture.src = "https://via.placeholder.com/120";
        profilePicture.style.display = "none";
        profilePicturePlaceholder.style.display = "flex";
        profileImageUrl = '';
      };
      profilePicturePlaceholder.style.display = "none";
      profileActionMark.textContent = "×";

      alert("Profile picture uploaded successfully!");
    } catch (error) {
      console.error("Error uploading profile picture:", error);
      alert(`Failed to upload profile picture: ${error.message}`);
      profilePictureInput.value = "";
    }
  }

  async function removeProfilePicture() {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    try {
      profileImageUrl = '';
      await updateDoc(doc(db, "users", currentUsername), {
        "profile.profilePicture": null
      });
      profilePicture.src = "https://via.placeholder.com/120";
      profilePicture.style.display = "none";
      profilePicturePlaceholder.style.display = "flex";
      profileActionMark.textContent = "+";
      alert("Profile picture removed successfully!");
    } catch (error) {
      console.error("Error removing profile picture:", error);
      alert(`Failed to remove profile picture: ${error.message}`);
    }
  }

  profilePictureInput.addEventListener("change", updateProfileImage);

  window.openEditModal = () => {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    if (!isDataLoaded || !currentUserData) {
      alert("User data is still loading. Please wait.");
      return;
    }

    const modal = document.getElementById("editModal");
    document.getElementById("editFullName").value = currentUserData.fullName || currentUserData.username || "";
    document.getElementById("editUsername").value = currentUserData.username || "";
    document.getElementById("editEmail").value = currentUserData.email || "";
    document.getElementById("editDob").value = currentUserData.dateOfBirth || "";
    document.getElementById("editRole").value = userRole || "coder";
    document.getElementById("editLanguages").value = currentUserData.answers?.languages || "";
    document.getElementById("editAppTypes").value = currentUserData.answers?.appTypes || "";
    document.getElementById("editIsTopCoder").value = currentUserData.profile?.isTopCoder ? "true" : "false";
    selectedSkills = currentUserData.profile?.skills || [];
    renderSkillsTags();
    projects = currentUserData.projects || [];
    renderProjectsForm();
    document.getElementById("editInterests").value = currentUserData.profile?.interests?.join(", ") || "";
    document.getElementById("editDistrict").value = currentUserData.profile?.location?.district || "";
    document.getElementById("editState").value = currentUserData.profile?.location?.state || "";
    document.getElementById("editCountry").value = currentUserData.profile?.location?.country || "";
    document.getElementById("editJoined").value = currentUserData.profile?.joined || "";
    document.getElementById("editGithubLink").value = currentUserData.profile?.linkedAccounts?.github || "";
    document.getElementById("editLinkedinLink").value = currentUserData.profile?.linkedAccounts?.linkedin || "";
    document.getElementById("editInstagramLink").value = currentUserData.profile?.linkedAccounts?.instagram || "";
    document.getElementById("editWebsiteLink").value = currentUserData.profile?.linkedAccounts?.website || "";

    toggleModalFields(userRole || "coder");
    modal.style.display = "flex";
  };

  window.closeEditModal = () => {
    document.getElementById("editModal").style.display = "none";
    selectedSkills = [];
    skillsTags.innerHTML = "";
    skillsInput.value = "";
    skillsSuggestions.style.display = "none";
    projects = [];
    document.getElementById("projectsContainer").innerHTML = "";
  };

  window.removeSkill = (skill) => {
    if (!isOwner) {
      return;
    }
    selectedSkills = selectedSkills.filter(s => s !== skill);
    renderSkillsTags();
  };

  window.addProjectBox = () => {
    projects.push({
      name: "",
      title: "",
      ideaBy: "",
      completedOn: "",
      rating: 0,
      description: "",
      tags: [],
      codeLink: "",
      liveLink: "",
      projectLink: ""
    });
    renderProjectsForm();
  };

  window.removeProjectBox = (index) => {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    projects.splice(index, 1);
    renderProjectsForm();
  };

  function renderProjectsForm() {
    const container = document.getElementById("projectsContainer");
    container.innerHTML = "";
    projects.forEach((project, index) => {
      const projectBox = document.createElement("div");
      projectBox.className = "project-box";
      projectBox.innerHTML = `
        <button class="add-project-btn" onclick="addProjectBox()">+</button>
        <button class="remove-project-btn" onclick="removeProjectBox(${index})">−</button>
        <div class="form-group">
          <label for="projectName${index}">Project Name</label>
          <input type="text" id="projectName${index}" value="${sanitizeHTML(project.name || "")}" required />
        </div>
        <div class="form-group">
          <label for="projectTitle${index}">Project Title</label>
          <input type="text" id="projectTitle${index}" value="${sanitizeHTML(project.title || "")}" />
        </div>
        <div class="form-group">
          <label for="projectIdeaBy${index}">Idea By</label>
          <input type="text" id="projectIdeaBy${index}" value="${sanitizeHTML(project.ideaBy || "")}" />
        </div>
        <div class="form-group">
          <label for="projectCompletedOn${index}">Completed On</label>
          <input type="date" id="projectCompletedOn${index}" value="${sanitizeHTML(project.completedOn || "")}" />
        </div>
        <div class="form-group">
          <label for="projectRating${index}">Rating (0-5)</label>
          <input type="number" id="projectRating${index}" min="0" max="5" value="${project.rating || 0}" />
        </div>
        <div class="form-group">
          <label for="projectDescription${index}">Description</label>
          <input type="text" id="projectDescription${index}" value="${sanitizeHTML(project.description || "")}" />
        </div>
        <div class="form-group">
          <label for="projectTags${index}">Tags (comma-separated)</label>
          <input type="text" id="projectTags${index}" value="${project.tags ? project.tags.join(", ") : ""}" />
        </div>
        <div class="form-group">
          <label for="projectCodeLink${index}">Code Link</label>
          <input type="url" id="projectCodeLink${index}" value="${sanitizeHTML(project.codeLink || "")}" placeholder="https://github.com/..." />
        </div>
        <div class="form-group">
          <label for="projectLiveLink${index}">Live Link</label>
          <input type="url" id="projectLiveLink${index}" value="${sanitizeHTML(project.liveLink || "")}" placeholder="https://..." />
        </div>
        <div class="form-group">
          <label for="projectProjectLink${index}">Project Link</label>
          <input type="url" id="projectProjectLink${index}" value="${sanitizeHTML(project.projectLink || "")}" placeholder="https://..." />
        </div>
      `;
      container.appendChild(projectBox);
    });
    if (projects.length === 0) {
      addProjectBox();
    }
  }

  window.confirmSave = () => {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    if (confirm("Are you sure you want to save changes?")) {
      saveProfile();
    }
  };

  function toggleModalFields(role) {
    const coderFields = document.querySelectorAll(".coder-only");
    const nonCoderFields = document.querySelectorAll(".non-coder-only");
    if (role === "coder") {
      coderFields.forEach(field => field.style.display = "block");
      nonCoderFields.forEach(field => field.style.display = "none");
    } else {
      coderFields.forEach(field => field.style.display = "none");
      nonCoderFields.forEach(field => field.style.display = "block");
    }
  }

  async function saveProfile() {
    if (!isOwner) {
      alert("You are not authorized to edit this profile.");
      return;
    }
    const fullName = document.getElementById("editFullName").value.trim();
    const username = document.getElementById("editUsername").value.trim();
    const email = document.getElementById("editEmail").value.trim();
    const dateOfBirth = document.getElementById("editDob").value;
    const role = document.getElementById("editRole").value;
    const languages = document.getElementById("editLanguages").value.trim();
    const appTypes = document.getElementById("editAppTypes").value.trim();
    const isTopCoder = document.getElementById("editIsTopCoder").value === "true";
    const interests = document.getElementById("editInterests").value.trim();
    const district = document.getElementById("editDistrict").value.trim();
    const state = document.getElementById("editState").value.trim();
    const country = document.getElementById("editCountry").value.trim();
    const joined = document.getElementById("editJoined").value;
    const githubLink = document.getElementById("editGithubLink").value.trim();
    const linkedinLink = document.getElementById("editLinkedinLink").value.trim();
    const instagramLink = document.getElementById("editInstagramLink").value.trim();
    const websiteLink = document.getElementById("editWebsiteLink").value.trim();

    // Collect project data
    const updatedProjects = [];
    projects.forEach((_, index) => {
      const name = document.getElementById(`projectName${index}`).value.trim();
      const title = document.getElementById(`projectTitle${index}`).value.trim();
      const ideaBy = document.getElementById(`projectIdeaBy${index}`).value.trim();
      const completedOn = document.getElementById(`projectCompletedOn${index}`).value;
      const rating = parseInt(document.getElementById(`projectRating${index}`).value) || 0;
      const description = document.getElementById(`projectDescription${index}`).value.trim();
      const tags = document.getElementById(`projectTags${index}`).value.split(",").map(tag => tag.trim()).filter(Boolean);
      const codeLink = document.getElementById(`projectCodeLink${index}`).value.trim();
      const liveLink = document.getElementById(`projectLiveLink${index}`).value.trim();
      const projectLink = document.getElementById(`projectProjectLink${index}`).value.trim();

      if (name && title) { // Only add projects with a name and title
        updatedProjects.push({
          name,
          title,
          ideaBy,
          completedOn,
          rating,
          description,
          tags,
          codeLink,
          liveLink,
          projectLink
        });
      }
    });

    if (!fullName || !username || !email || !dateOfBirth || !role) {
      alert("Please fill in all required fields.");
      return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert("Please enter a valid email address.");
      return;
    }

    const urlRegex = /^(https?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?$/;
    if (githubLink && !urlRegex.test(githubLink)) {
      alert("Please enter a valid GitHub URL.");
      return;
    }
    if (linkedinLink && !urlRegex.test(linkedinLink)) {
      alert("Please enter a valid LinkedIn URL.");
      return;
    }
    if (instagramLink && !urlRegex.test(instagramLink)) {
      alert("Please enter a valid Instagram URL.");
      return;
    }
    if (websiteLink && !urlRegex.test(websiteLink)) {
      alert("Please enter a valid Website URL.");
      return;
    }

    try {
      const updatedData = {
        fullName,
        username,
        email,
        dateOfBirth,
        role,
        answers: {
          languages: role === "coder" ? (languages || "") : "",
          appTypes: role === "coder" ? (appTypes || "") : ""
        },
        profile: {
          ...(currentUserData.profile || {}),
          isTopCoder: role === "coder" ? isTopCoder : false,
          skills: role === "coder" ? selectedSkills : [],
          interests: role === "non-coder" ? interests.split(",").map(item => item.trim()).filter(Boolean) : [],
          location: {
            district: district || "",
            state: state || "",
            country: country || ""
          },
          joined: joined || "",
          linkedAccounts: {
            github: githubLink || "",
            linkedin: linkedinLink || "",
            instagram: instagramLink || "",
            website: websiteLink || ""
          }
        },
        projects: role === "coder" ? updatedProjects : []
      };

      await updateDoc(doc(db, "users", currentUsername), updatedData);

      currentUserData = { ...currentUserData, ...updatedData };
      userRole = role;

      updateProfileUI(updatedData);

      closeEditModal();
      alert("Profile updated successfully!");
    } catch (error) {
      console.error("Error updating profile:", error);
      alert("Failed to update profile: " + error.message);
    }
  }

  function calculateLevel(projectCount) {
    if (projectCount >= 4) return 3;
    if (projectCount === 3) return 2;
    if (projectCount >= 1) return 1;
    return 0;
  }

  function updateProfileUI(data) {
    const role = data.role;
    userRole = role;
    toggleProfileSections(role);

    document.getElementById("basicFullName").textContent = data.fullName || "Not specified";
    document.getElementById("basicEmail").textContent = data.email || "Not specified";
    document.getElementById("basicDob").textContent = data.dateOfBirth || "Not specified";
    document.getElementById("basicRole").textContent = role ? role.charAt(0).toUpperCase() + role.slice(1) : "Not specified";
    document.getElementById("fullName").textContent = data.fullName || "Not specified";
    document.getElementById("fullName").dataset.username = data.username || "";
    document.getElementById("topCoderBadge").style.display = (role === "coder" && data.profile?.isTopCoder) ? "inline-block" : "none";

    // Update level based on project count
    const projectCount = data.projects?.length || 0;
    const level = calculateLevel(projectCount);
    document.getElementById("level").textContent = `Level ${level}`;

    if (role === "coder") {
      const skillsList = document.getElementById("skillsList");
      skillsList.innerHTML = "";
      const skills = data.profile?.skills || [];
      if (skills.length) {
        skills.forEach(skill => {
          const span = document.createElement("span");
          span.className = "skill";
          span.textContent = skill;
          skillsList.appendChild(span);
        });
      } else {
        skillsList.innerHTML = "<span class='skill'>None</span>";
      }

      const projectsList = document.getElementById("projectsList");
      projectsList.innerHTML = "";
      if (data.projects?.length) {
        data.projects.forEach(project => {
          const card = document.createElement("div");
          card.className = "project-card";

          const title = document.createElement("h3");
          title.textContent = sanitizeHTML(project.name || project.title || "Untitled");

          const meta = document.createElement("div");
          meta.className = "project-meta";
          const ideaBySpan = document.createElement("span");
          ideaBySpan.textContent = `Idea By: ${sanitizeHTML(project.ideaBy || "Unknown")}`;
          const completedOnSpan = document.createElement("span");
          completedOnSpan.textContent = `Completed On: ${sanitizeHTML(project.completedOn || "Not specified")}`;
          const ratingSpan = document.createElement("span");
          ratingSpan.className = "rating";
          ratingSpan.textContent = `⭐ Rating: ${sanitizeHTML((project.rating || 0).toString())}/5`;
          meta.appendChild(ideaBySpan);
          meta.appendChild(completedOnSpan);
          meta.appendChild(ratingSpan);

          const description = document.createElement("p");
          description.className = "project-description";
          description.textContent = sanitizeHTML(project.description || "No description");

          const tagsDiv = document.createElement("div");
          tagsDiv.className = "project-tags";
          if (project.tags?.length) {
            project.tags.forEach(tag => {
              const tagSpan = document.createElement("span");
              tagSpan.className = "tag";
              tagSpan.textContent = sanitizeHTML(tag);
              tagsDiv.appendChild(tagSpan);
            });
          }

          const linksDiv = document.createElement("div");
          linksDiv.className = "project-links";
          if (project.codeLink) {
            const codeLink = document.createElement("a");
            codeLink.href = project.codeLink;
            codeLink.target = "_blank";
            codeLink.textContent = "View Code";
            linksDiv.appendChild(codeLink);

            const starIcon = document.createElement("img");
            starIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";
            starIcon.className = "star-icon";
            starIcon.alt = "Star Icon";
            starIcon.onclick = () => window.open(project.codeLink, "_blank");
            linksDiv.appendChild(starIcon);
          }
          if (project.liveLink) {
            const liveLink = document.createElement("a");
            liveLink.href = project.liveLink;
            liveLink.target = "_blank";
            liveLink.textContent = "Visit Live App";
            linksDiv.appendChild(liveLink);

            const starIcon = document.createElement("img");
            starIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";
            starIcon.className = "star-icon";
            starIcon.alt = "Star Icon";
            starIcon.onclick = () => window.open(project.liveLink, "_blank");
            linksDiv.appendChild(starIcon);
          }
          if (project.projectLink) {
            const projectLink = document.createElement("a");
            projectLink.href = project.projectLink;
            projectLink.target = "_blank";
            projectLink.textContent = "Project Link";
            linksDiv.appendChild(projectLink);

            const starIcon = document.createElement("img");
            starIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";
            starIcon.className = "star-icon";
            starIcon.alt = "Star Icon";
            starIcon.onclick = () => window.open(project.projectLink, "_blank");
            linksDiv.appendChild(starIcon);
          }

          card.appendChild(title);
          card.appendChild(meta);
          card.appendChild(description);
          card.appendChild(tagsDiv);
          card.appendChild(linksDiv);
          projectsList.appendChild(card);
        });
      } else {
        projectsList.innerHTML = "<p>No projects yet.</p>";
      }
    } else {
      const interestsList = document.getElementById("interestsList");
      interestsList.innerHTML = "";
      const interestsArray = data.profile?.interests || [];
      if (interestsArray.length) {
        interestsArray.forEach(interest => {
          const span = document.createElement("span");
          span.className = "skill";
          span.textContent = interest;
          interestsList.appendChild(span);
        });
      } else {
        interestsList.innerHTML = "<span class='skill'>None</span>";
      }

      const nonCoderDetails = document.getElementById("nonCoderDetails");
      nonCoderDetails.textContent = interestsArray.length ? interestsArray.join(", ") : "No additional information provided.";
    }

    const location = data.profile?.location || {};
    const locationStr = [location.district, location.state, location.country].filter(Boolean).join(", ") || "Not specified";
    document.getElementById("location").textContent = locationStr;
    document.getElementById("joined").textContent = data.profile?.joined || data.createdAt || "Not specified";

    const linkedAccounts = data.profile?.linkedAccounts || {};
    const githubLinkEl = document.getElementById("githubLink");
    const linkedinLinkEl = document.getElementById("linkedinLink");
    const instagramLinkEl = document.getElementById("instagramLink");
    const websiteLinkEl = document.getElementById("websiteLink");
    githubLinkEl.href = linkedAccounts.github || "#";
    githubLinkEl.style.display = linkedAccounts.github ? "inline" : "none";
    linkedinLinkEl.href = linkedAccounts.linkedin || "#";
    linkedinLinkEl.style.display = linkedAccounts.linkedin ? "inline" : "none";
    instagramLinkEl.href = linkedAccounts.instagram || "#";
    instagramLinkEl.style.display = linkedAccounts.instagram ? "inline" : "none";
    websiteLinkEl.href = linkedAccounts.website || "#";
    websiteLinkEl.style.display = linkedAccounts.website ? "inline" : "none";

    const githubIconLink = document.getElementById("githubIconLink");
    const linkedinIconLink = document.getElementById("linkedinIconLink");
    const instagramIconLink = document.getElementById("instagramIconLink");
    const websiteIconLink = document.getElementById("websiteIconLink");
    githubIconLink.href = linkedAccounts.github || "#";
    githubIconLink.style.display = linkedAccounts.github ? "block" : "none";
    linkedinIconLink.href = linkedAccounts.linkedin || "#";
    linkedinIconLink.style.display = linkedAccounts.linkedin ? "block" : "none";
    instagramIconLink.href = linkedAccounts.instagram || "#";
    instagramIconLink.style.display = linkedAccounts.instagram ? "block" : "none";
    websiteIconLink.href = linkedAccounts.website || "#";
    websiteIconLink.style.display = linkedAccounts.website ? "block" : "none";
  }

  window.scrollToProjects = () => {
    document.getElementById("projectsSection").scrollIntoView({ behavior: "smooth" });
  };

  document.getElementById("shareProfileBtn").addEventListener("click", () => {
    const username = document.getElementById("fullName").dataset.username;
    const profileLink = `https://echo.com/profile/${username}`;
    navigator.clipboard.writeText(profileLink).then(() => {
      alert("Profile link copied to clipboard!");
    }).catch(err => {
      console.error("Failed to copy link:", err);
      alert("Failed to copy link: " + err.message);
    });
  });

  function toggleProfileSections(role) {
    const coderElements = document.querySelectorAll(".coder-only");
    const nonCoderElements = document.querySelectorAll(".non-coder-only");
    if (role === "coder") {
      coderElements.forEach(el => el.style.display = "block");
      nonCoderElements.forEach(el => el.style.display = "none");
    } else {
      coderElements.forEach(el => el.style.display = "none");
      nonCoderElements.forEach(el => el.style.display = "block");
    }
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "file:///C:/Users/sunny/OneDrive/Desktop/echo/login/login.html";
      return;
    }

    try {
      loggedInUserUid = user.uid;

      let username = new URLSearchParams(window.location.search).get("username");

      if (!username) {
        const userQuery = query(collection(db, "users"), where("uid", "==", loggedInUserUid));
        const userSnapshot = await getDocs(userQuery);

        if (userSnapshot.empty) {
          alert("Your profile could not be found.");
          window.location.href = "file:///C:/Users/sunny/OneDrive/Desktop/echo/login/message/message.html";
          return;
        }

        const userDoc = userSnapshot.docs[0];
        username = userDoc.data().username;
        currentUsername = userDoc.id;
        currentUserData = userDoc.data();
        isOwner = true;
      } else {
        const usersQuery = query(collection(db, "users"), where("username", "==", username));
        const usersSnapshot = await getDocs(usersQuery);

        if (usersSnapshot.empty) {
          alert("User not found.");
          window.location.href = "file:///C:/Users/sunny/OneDrive/Desktop/echo/login/message/message.html";
          return;
        }

        const userDoc = usersSnapshot.docs[0];
        currentUsername = userDoc.id;
        currentUserData = userDoc.data();
        isOwner = currentUserData.uid === loggedInUserUid;
      }

      userRole = currentUserData.role || "non-coder";
      toggleProfileSections(userRole);

      const editProfileBtn = document.getElementById("editProfileBtn");
      const profileActionMark = document.getElementById("profileActionMark");

      if (isOwner) {
        editProfileBtn.style.display = "block";
        profileActionMark.style.display = "flex";
        profilePictureContainer.addEventListener("click", window.triggerProfilePictureUpload);
      } else {
        editProfileBtn.style.display = "none";
        profileActionMark.style.display = "none";
        profilePictureContainer.removeEventListener("click", window.triggerProfilePictureUpload);
      }

      isDataLoaded = true;

      profileImageUrl = currentUserData.profile?.profilePicture || '';
      if (profileImageUrl) {
        profilePicture.src = profileImageUrl;
        profilePicture.style.display = "block";
        profilePicturePlaceholder.style.display = "none";
        if (isOwner) {
          profileActionMark.textContent = "×";
        }
      } else {
        profilePicture.src = "https://via.placeholder.com/120";
        profilePicture.style.display = "none";
        profilePicturePlaceholder.style.display = "flex";
        if (isOwner) {
          profileActionMark.textContent = "+";
        }
      }

      updateProfileUI(currentUserData);
    } catch (error) {
      console.error("Error loading profile:", error);
      alert("Failed to load profile: " + error.message);
      window.location.href = "file:///C:/Users/sunny/OneDrive/Desktop/echo/login/message/message.html";
    }
  });

  document.getElementById("editRole").addEventListener("change", (e) => {
    const selectedRole = e.target.value;
    toggleModalFields(selectedRole);
  });
</script>
</body>
</html>